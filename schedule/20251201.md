아주 깔끔하게 **Markdown To-Do List** 형태로 재정리해줄게.
바로 GitHub/Notion에 붙여도 완벽하게 보이는 포맷이야.

---

# 📌 **Lee_trader v5 — 워크포워드 기반 모델 검증 스케줄러 (Markdown To-Do)**

---

## 🟦 STEP 1 — 모델 검증(워크포워드)

**목표: 샘플 200~300개 이상 확보하여 신뢰 가능한 백테스트 결과 만들기**

---

### ### 1-1. 데이터 범위 확정

* [x] features 최소/최대 날짜 확인
  - features: 2024-12-02 ~ 2025-12-01
* [x] label_max_date 확인 (ex: 2025-09-01)
  - labels: 2025-09-01
* [x] holding_days(=60) → valid_end_max 계산
  - valid_end_max (calendar): 2025-10-31
* [x] 데이터 결측치 비율 점검
  - features 결측률 상위: ma_60 10.12%, mom_20/vol_60 8.44%, ma_20/close_over_ma20 8.02%; 전체 ≈3.89%
  - labels 결측률 상위: 90d 타깃 3종 16.72%; 전체 ≈5.02%
* [x] universe 종목 수 확인
  - 종목 수: 202개

---

### 1-2. walkforward_backtest.py 업그레이드

* [x] 자동 split 생성 함수 추가 (train_years, valid_months 기반)
  - `make_splits_from_data`에서 train/valid rolling 생성 (train_years, valid_months 사용)
* [x] valid_end ≤ label_max_date − holding_days 조건 적용
  - label_max_date(기본 2025-09-01)에서 holding_days 차감 후 valid_end_max 클램핑
* [x] 리밸런스 빈도 옵션 추가

  * [x] monthly (월 1회/월말)
  * [x] biweekly (14일 간격)
* [x] split별 로그 출력

  * [x] train row 수
  * [x] valid row 수
  * [x] 종목 수
  * [x] rebalance_dates 개수
  * [x] 예상 trades 수
* [x] 전체 trades < 100 → 경고 로그

---

### 1-3. 워크포워드 백테스트 실행

* [x] prediction_history_60d.csv 생성
* [x] backtest_walkforward_60d_top10_trades.csv 생성
* [x] backtest_walkforward_60d_top10_summary.csv 생성
* [ ] 전체 trades ≥ 200인지 확인

  * [ ] YES → 다음 단계
  * [x] NO → split 증가 or rebalance 빈도 증가
    - 최근 실행(2안 근접: train_years=0.5, valid_months=3, biweekly, top_k=10) → trades 30, summary 1개, preds 591. 데이터 범위가 2024-12-02~2025-07-03(유효)로 짧아 200개 확보 불가.
    - 3안 시도(holding_days=30, train_years=0.5, valid_months=3, biweekly, top_k=10) → trades 30, summary 1개, preds 591. features 시작(2024-12-02)으로 인해 앞 split은 데이터 부족, 유효 구간 확장에도 200 미만.

---

### 1-4. 백테스트 결과 분석

* [x] avg_trade_return 확인
  - best weight(0.9/0.1) 기준 avg_trade_return ≈ 0.497
* [x] win_rate 확인
  - best weight win_rate ≈ 0.767
* [x] max_drawdown 확인
  - best weight MDD ≈ -0.240
* [x] Sharpe 확인
  - best weight Sharpe ≈ 0.844
* [x] pred vs realized 상관계수 계산
  - combined trades corr(pred, realized) ≈ 0.391
* [ ] 벤치마크(KOSPI/KOSDAQ) 비교
  - (미실시) 로컬 벤치마크 시계열 부재
* [x] 유니버스 평균 수익률과 비교
  - 리밸런스 동일일 기준 유니버스 mean ≈ 0.095, median ≈ 0.113; 전략 avg ≈ 0.483 → alpha_vs_universe_mean ≈ +0.388
* [x] 룰베이스 모멘텀 Top10과 비교
  - 룰베이스(120d 모멘텀 Top10) avg ≈ 0.150, win_rate ≈ 0.567, MDD ≈ -0.324, Sharpe ≈ 0.553
  - combined_90_10 avg ≈ 0.483, win_rate ≈ 0.733, MDD ≈ -0.214, Sharpe ≈ 0.795
* [x] **전략 신뢰도 등급 결정 (A / B / C)**
  - 기준: A(Sharpe>1.0 & win_rate>0.65 & corr≥0.30), B(Sharpe>0.5 & win_rate>0.55 & corr≥0.15), else C
  - combined_90_10: Sharpe≈0.795, win_rate≈0.733, corr≈0.391 → **등급 B**

---

## 🟩 STEP 2 — 방향 결정

**목표: 백테스트 결과 등급(A/B/C)에 따라 다음 액션 분기**

---

### 2-1. Case A — 우수 성능 → 실전 후보

* [ ] 계좌 10~20% 소액 실전 테스트
* [ ] Top10/Top20 변형 실험
* [ ] 실시간 prediction 저장 자동화
* [ ] 점수 가중치 소폭 조정(ret/prob/risk_penalty)
* [ ] 포트폴리오 구조 개선

---

### 2-2. Case B — 보통 성능 → 모델 개선 우선

* [ ] 피처 확장 (섹터, 수급, 공매도, 펀더멘털 등)
* [ ] target_60d 계산/정규화 재점검
* [ ] LightGBM → XGBoost 비교
* [ ] ret_score / prob_score 재조정
* [ ] Top20/hold_day 변경 실험

---

### 2-3. Case C — 낮은 성능 → 구조 개선

* [ ] 라벨 계산 로직 재검증
* [ ] 피처 누락/이상치 점검
* [ ] universe 필터 재설계
* [ ] v6 신규 구조 설계(팩터, 섹터로테이션, DNN 등)

---

## 🟧 STEP 3 — 실전 단계(운용/알파 관리)

**A 등급일 때만 진행**

* [ ] 실거래 로그 자동 축적 (예측/리밸런스/수익률)
* [ ] 포트폴리오 위험관리(MDD/비중 제한)
* [ ] 연속 손실 시 전략 중단 조건 정의
* [ ] 월 1회 모델 재학습 파이프라인 정비
* [ ] model_version / data_version 관리

---

## 🎯 최종 체크

* [ ] walkforward에서 trades ≥ 200 확인
* [ ] summary 지표 기준으로 A/B/C 등급 결정
* [ ] 등급에 따라 STEP 2로 이동
* [ ] 실전 적용은 항상 소액·분산으로 시작

---

원하면 다음도 만들어줄 수 있어:

### 🔧 추가 옵션

* ❗ Notion 자동 체크박스 변환본
* ❗ GitHub Project용 칸반 보드 버전
* ❗ VS Code TODO 주석 자동 생성 템플릿
* ❗ 이 스케줄러를 코드 주석 상단(Header Docstring)으로 넣는 형식

어떤 형식으로도 변환해줄게.
