# Lee_Trader 실전 매매 PRD 체크리스트

---

## 0. 현재 설정 상태 (스냅샷)

- [x] 메인 전략: 60d 예측 + 30d 보조 **combined_90_10**
- [x] 모델 타입: LightGBM (회귀, target_60d 중심)
- [x] 전략 등급: B (Sharpe≈0.80, win_rate≈0.73, corr≈0.39)
- [x] 룰베이스 모멘텀 / 유니버스 평균 대비 초과성과 검토 완료
- [ ] 운영 버전 이름/버전 지정 (예: `strategy_v1.0_combined_90_10`)

---

## 1. 데이터/ 백테스트 의뢰사항 (P0 필수)

### 1-1. 거래 비용 및 슬리피지 반영

- [x] 수수료 기본 가정 정의 (왕복 0.03%, fee_pct=0.0003)
- [x] 슬리피지 기본 가정 정의 (총 0.2%, slippage_pct=0.002)
- [x] `walkforward_backtest.py` / `backtest_walkforward.py`에
  - [x] 수수료 차감 로직 추가
  - [x] 슬리피지 차감 로직 추가
- [x] 비용/슬리피지 반영 후:
  - 60d(biweekly Top10): avg≈0.498, win_rate≈0.717, Sharpe≈2.46, trades=60
  - 30d(biweekly Top10): avg≈0.230, win_rate≈0.667, Sharpe≈2.48, trades=60
  - 무비용 대비 avg/total_ret 소폭 하락, 승률·Sharpe 큰 변화 없음 (비용 반영 완료)

### 1-2. 벤치마크(KOSPI/KOSDAQ) 비교

- [x] KOSPI, KOSDAQ 일별 종가 시계열 CSV 확보
  - `data/benchmarks/kospi_069500.csv`, `data/benchmarks/kosdaq_229200.csv` (네이버 ETF 1200행 다운로드 완료)
- [x] 동일 기간 누적 수익률/ 연환산 수익률(CAGR) 계산
  - `benchmark_etf_comparison.py`에서 전략 일수익률(60d 분해) vs ETF 일수익률로 계산
- [ ] 전략 vs KOSPI vs KOSDAQ:
  - [ ] 누적수익률 그래프 (미생성)
  - [x] 연환산 수익률(CAGR) / 변동성(σ) / Sharpe / Alpha 산출 완료
    - 요약: 전략 cum≈1.46, CAGR≈9.52, vol≈0.331, Sharpe≈4.12, alpha_vs_kospi≈9.37, alpha_vs_kosdaq≈9.39 (일단위 분해 기준)
- [ ] 필요 시 ETF 혹은 선물로 대체 가능한지 분석 메모 작성

### 1-3. TopK / 비중 최적화

- [ ] TopK 후보 시나리오 비교 (Top10, Top15, Top20)
  - [ ] 각 시나리오 백테스트 수행
  - [ ] 성과/리스크 비교표 작성
- [ ] 최종 TopK 선택 (기본 Top10)
- [ ] 포트폴리오 비중 규칙 정의
  - [ ] 종목별 비중 (예: Top10 균등 10%)
  - [ ] 섹터 비중 허용 범위 (예: 0~20%)

### 1-4. 유동성 필터

- [ ] 최소 거래대금 기준 설정 (예: 최근 20일 평균 거래대금 X억 이상)
- [ ] 예측/검증 시 데이터 라인에 유동성 필터 추가
- [ ] 필터 전후 예측 리스크/성과 비교 (체결 가능 종목/거래 결과 확인)

---

## 2. 매매 규칙 / 실행 옵션 (P0~P1)

### 2-1. 리밸런스 & 보유 기간

- [x] 기본 리밸런스 주기: BIWEEKLY(격주) 적용
- [ ] WEEKLY 옵션 백테스트 후 주기 조정 여부 판단
- [ ] 기본 보유 기간 재설정
  - [ ] 최대 60일 보유
  - [ ] 리밸런스 시점에 교체 종목 즉시 교체

### 2-2. 매수/매도 규칙

- [ ] 매수 규칙 문서화
  - [ ] 리밸런스 선정 종목 기반 매수
  - [ ] 신호 발생일 마감 근처 체결 방식 논의 (시장가/지정가)
- [ ] 매도 규칙 문서화
  - [ ] 리밸런스 교체
  - [ ] 손절/익절 트리거 (3-2 섹션 연계)

---

## 3. 리스크 관리 (P1 안정화)

### 3-1. 포트폴리오 리스크 관리

- [ ] 섹터 쏠림 제한 규칙
  - [ ] 단일 섹터 최대 비중 (예: 40%)
  - [ ] 단일 종목 포지션 쿨다운 여부 검토
- [ ] 개별 종목 리스크 모니터
  - [ ] 예측 MDD 기반 최대 보유 리스크(예: pred_mdd_60d < -35% 제외)

### 3-2. 손절/익절 규칙

- [ ] 손절 후보 기준 시나리오 논의
  - [ ] 예: -10%, -15% 구간 알람/청산
- [ ] 익절 후보 기준 시나리오 논의
  - [ ] 예: +20%, +30% 구간 알람/청산
- [ ] 손절/익절 규칙 반영 후 백테스트 실행
- [ ] 최종 손절/익절 규칙 결정 및 문서화

### 3-3. 계좌 단위 리스크

- [ ] 계좌 기준 최대 손실 한도 논의 (예: 기간 MDD -10% 도달 시 중단)
- [ ] 계좌 MDD 모니터링 로직 설계
- [ ] 리스크 한도 초과 시 운영 중단/축소 프로세스 논의

---

## 4. 실행 프로세스/ 시그널 파이프라인 (P0~P1)

### 4-1. 시그널 생성

- [ ] `signal_generator.py` (또는 유사 모듈) 설계
  - [ ] 최신 예측/랭킹에서 TopK 추출
  - [ ] 매수/매도 액션 컬럼 포함
- [ ] 매일/격주 자동 실행 파이프라인 설계 (cron, Task Scheduler 등)
- [ ] 출력 포맷 논의
  - [ ] `signals/signal_{date}.csv`
  - [ ] 컬럼: date, code, name, action(buy/sell/hold), weight, price_hint 등

### 4-2. 포트폴리오 상태 관리

- [ ] `current_portfolio.csv` 구조 정의
- [ ] 거래 발생 시 포트폴리오 업데이트 로직 구현
- [ ] `trade_history.csv` 로그 포맷 정의 및 구현

### 4-3. 자동 매매 프로세스

- [ ] 사람-HTS/MTS에서 실제 주문까지 이어지는 자동화 문서화
  - [ ] 신호 생성→주문 입력→체결 확인→포트폴리오 반영
- [ ] 미체결/오류/부분체결 시 처리 규칙

---

## 5. 모니터링 / 리포트 (P1~P2)

### 5-1. 일/주간 모니터링

- [ ] 일간 수익률 계산 및 로그 저장
- [ ] 주간 수익률/ 누적 수익률 집계
- [ ] 종목별 실현/미실현 수익 관리

### 5-2. 벤치마크 대비 모니터링

- [ ] 전략 vs KOSPI vs KOSDAQ 일간/주간 비교 차트
- [ ] 월별/분기별 성과 요약 리포트 템플릿 작성
- [ ] `report/weekly_report_{date}.md` 자동 생성 스크립트

### 5-3. 모델 건강도 체크

- [ ] 예측 구간에서
  - [ ] 예측 vs 실제 60d 수익률 상관계수 주기적 계산
  - [ ] Sharpe / 승률 / MDD 주기적 계산
- [ ] 모델 건강도 임계값 정의
  - [ ] 예: corr < 0.1, Sharpe < 0.3 시 재교육/중단 고려
- [ ] 재교육/롤백 기준 및 운영/중단 프로세스 논의

---

## 6. 모델/지표 스코어 고도화 (P1~P2 필요 시)

### 6-1. 데이터/피처 확장

- [ ] 섹터/수급 피처 추가
- [ ] 수급(외국인/기관), 공매도, 거래대금 관련 피처 추가
- [ ] 기본 펀더멘털(매출, PER, PBR, ROE 등) 피처 추가
- [ ] 피처 중요도 분석 및 과적합 여부 점검

### 6-2. 모델 비교/고도화

- [ ] LightGBM vs XGBoost vs 기타 (CatBoost 등) 비교 실험
- [ ] 하이퍼파라미터 튜닝 (Optuna 등)
- [ ] 모델 버전 관리(v1.0, v1.1 등)

### 6-3. 점수 스코어 v2

- [ ] `final_score_v2` 설계
  - [ ] 60d 예측 수익률
  - [ ] 30d 보조 시그널
  - [ ] 예측 MDD 기반 리스크 시그널 가중
  - [ ] (옵션) 퀄리티/모멘텀 혼합 스코어
- [ ] UI에서 최종 종합 점수 하나로 표현
- [ ] 예측수익률 vs 종합 점수 성능 비교하여 채택

---

## 7. 문서화/ 운영 관리

- [ ] PRD 문서(전략 설명, 의사결정 히스토리)
- [ ] CHANGELOG 관리 시작 (모델/스코어 변경 내역)
- [ ] 실전 운용 가이드(일/주 루틴) 문서화
  - [ ] 매일 아침/장중/마감 체크리스트
- [ ] 백업/복구 프로세스 정의 (코드 + 데이터)
