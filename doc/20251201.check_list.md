진행 현황 (2025-12-01 기준)
--------------------------
- 현재 완료 체크된 항목 없음. 우선 진행할 작업:
  - [x] EPIC 1-1: Node Dockerfile 빌드 오류(better-sqlite3 헤더 TLS) 해결
  - [x] EPIC 2-3: CSV → DB 일원화(각 단계 to_sql 병행) 설계 반영
  - [x] EPIC 3-4: backtest_walkforward 레이블 스케일 보정 후 재실행(거래비용 포함)
  - [x] EPIC 5-1: trade-history DB 기반 필터/조회 기능 점검 및 개선 반영

---

# 📌 Lee_trader v5 로드맵 체크리스트

**(Epic → Issue → Task Checklist 구조, GitHub Boards 맞춤)**

---

# 🚀 EPIC 1 – 인프라·DevOps 개선

### 1-1. Docker/환경 관리
- [ ] Python용 Dockerfile 멀티스테이지 최적화
- [ ] Node Dockerfile 최적화
- [ ] docker-compose 파이프라인/운영 실행 시간/로그 분리
- [ ] Windows + WSL + Docker 개발환경 셋업 문서 작성
- [ ] .env / secrets 템플릿 정리·통합

### 1-2. 의존성/패키지 관리
- [ ] requirements.txt → pyproject.toml(uv/poetry) 전환
- [ ] dev/test/prod 분리된 dependency 구조
- [ ] 자동 버전 업데이트 체크/크론잡 구성

### 1-3. 로깅/모니터링
- [ ] run_step 공통 로깅 래퍼 추가
- [ ] 각 스텝 input/output 메트릭 로깅
- [ ] pipeline_run.log 구조 개선 (JSON 로그 등)
- [ ] 에러 리포트 자동 생성
- [ ] 시장/모델 이상 알림 구조 설계

### 1-4. 테스트 코드 기반 만들기
- [ ] pytest 환경 세팅
- [ ] feature_builder 유닛테스트 10개
- [ ] label_builder 유닛테스트 10개
- [ ] scoring 유닛테스트 10개
- [ ] backtest 핵심 로직 단위 테스트
- [ ] Node API endpoint 테스트(supertest 기반)

---

# 📊 EPIC 2 – 데이터·파이프라인 고도화

### 2-1. 데이터 수집 확인/정합성 강화
- [ ] 가격 데이터 결측/비정상치 자동 리포트
- [ ] KIS API와 pykrx 데이터 mismatch 체크
- [ ] DART 재무데이터 검증
- [ ] 액면분할/유상증자 이벤트 로그화

### 2-2. 데이터 밸리데이션 도입
- [ ] pydantic 기반 CSV 스키마 정의
- [ ] great_expectations 기반 유효성 검증 파이프라인 구성
- [ ] 실행 중 anomaly 자동 감지(거래대금 급증 등)

### 2-3. CSV ↔ DB 일원화
- [ ] migrate_to_sqlite.py 제거하고 각 스텝에서 바로 DB write
- [ ] CSV는 optional export로 전환
- [ ] schema.sql 정식 문서 작성
- [ ] Alembic 기반 마이그레이션 구조 도입(선택)

### 2-4. 데이터 구조 개선
- [ ] 과거 랭킹(history/YYYYMMDD_ranking.csv) → DB용 테이블로 이전
- [ ] 가격 데이터(raw/clean/adjusted) 구분 명확화
- [ ] 시장 지표 데이터 분리
- [ ] 재무/퀄리티 데이터의 날짜 매핑 정정

---

# 🤖 EPIC 3 – 모델: 예측·점수·전략 강화

### 3-1. 피처 확장/고도화
- [ ] 피처 묶음(Level 1: 모멘텀/가격괴리/변동성/거래량)
- [ ] 섹터/업종 one-hot 추출
- [ ] 시장 상태(one-hot) 추출
- [ ] 이벤트(실적 발표/공시/배당) 피처 도입
- [ ] 주말/공휴일 캘린더 피처

### 3-2. 모델 구조 강화
- [ ] 수익률 모델 / MDD 모델 분리
- [ ] 분류(Top20) 모델 개선
- [ ] 앙상블(예: LightGBM + CatBoost + XGB stacking)
- [ ] validation: TimeSeriesSplit 기반 교차검증
- [ ] 모델 drift 모니터링

### 3-3. 점수 시스템 v5
- [ ] pred_score 계산식 개선
- [ ] risk_penalty 공식 강화(시장 변동성/섹터 리스크 반영)
- [ ] quality_score 비중 재조정
- [ ] final_score 구성요소 투명화(confidence intervals 포함)
- [ ] score 설명(Explanation) 기능 추가

### 3-4. 전략·백테스트 업그레이드
- [ ] Walk-forward 검증/백테스트 표준화
- [ ] 리밸런싱 주기 다양화(매일/주간/월간)
- [ ] 거래비용·슬리피지 반영
- [ ] 포트폴리오 최적화(리스크 버짓, 섹터 한도)
- [ ] 전략 비교 리포트 자동 생성

---

# 🗄️ EPIC 4 – DB/Node API 개선

### 4-1. Node API 기능 확장
- [ ] /api/ranking?date=YYYY-MM-DD
- [ ] /api/stocks/:code/history
- [ ] /api/model/metrics (모델 품질 리포트)
- [ ] /api/strategy/backtest (간단 파라미터)
- [ ] /api/trades/export (CSV 자동 생성)

### 4-2. DB 레벨 개선
- [ ] better-sqlite3 prepared statements 사용
- [ ] 가격/랭킹 인덱스 튜닝
- [ ] holdings 계산 SQL 최적화
- [ ] market_status join 정리
- [ ] DB vacuum & optimize 자동 스케줄링

### 4-3. Python/FastAPI 연합 가능성
- [ ] pydantic 스키마 → FastAPI 모델 변환
- [ ] 추천 API(Top Buy/Add/Trim) Python 서버 버전 검토
- [ ] Node + FastAPI 멀티서버 구조 검토
- [ ] 성능 비교 문서화

---

# 🎨 EPIC 5 – UI·리포트·프론트엔드 개선

### 5-1 UI 화면 개편
- [ ] public/*.html → React or Vue 전환(선택)
- [ ] 컴포넌트 기반 구조 확립
- [ ] Top20 테이블 반응형 UI
- [ ] holdings 그래프·차트 통합
- [ ] trade-history 데이터 UI 개선

### 5-2 대시보드 기능 강화
- [ ] TodayActionResponse UI 카드 제공
- [ ] 종목 클릭 시 상세 리포트 팝업
- [ ] 점수 추세 차트
- [ ] 섹터별 heatmap
- [ ] 포트폴리오 위험지표(개별 MDD, VaR)

### 5-3 자동 리포트
- [ ] Daily Report (HTML/Markdown/PDF)
- [ ] Weekly Summary 자동 생성
- [ ] 모델 성능 리포트(회귀/분류 메트릭)
- [ ] Top20 변화/보유 요약 자동 생성
- [ ] Slack/Discord Webhook 알림 구조

---

# 🛡️ EPIC 6 – 포트폴리오·리스크 관리

### 6-1 포트폴리오 관리 룰·스킴
- [ ] 비중 조절 규칙(max weight, sector max weight)
- [ ] 리스크 버짓 기반 포트폴리오
- [ ] 변동성 기반 포지션 크기 조절
- [ ] 목표 변동성(Target Volatility) 전략

### 6-2 리스크 모듈 구축
- [ ] 종목별/포트폴리오 MDD 실시간 계산
- [ ] 종목별 상관계수 기반 리스크 분석
- [ ] 시장 상태 분석(상승/횡보/하락)
- [ ] 종목 위험등급 분류 (High/Medium/Low Risk)

### 6-3 거래 기록·성과 측정
- [ ] Node UI에서 거래 입력 기능 추가
- [ ] 자동 수익 계산 + CAGR + 월별 수익률
- [ ] 전략별 결과 비교
- [ ] 운용 리포트 자동 생성(PDF/MD) 기능

---

# 🤖 EPIC 7 – 자동매매(중장기 목표)

선택지/ 설계안
- [ ] 국내 증권사/해외 브로커 API 래퍼 개발
- [ ] pseudo-order → 실제 주문 이행
- [ ] 주문 실패·부분체결 처리
- [ ] 실매매 risk control (max loss, stop loss)
- [ ] 거래 로그 + 백오피스 UI

---

# 📄 EPIC 8 – 문서/PRD/개발 가이드

### 8-1 문서 준비
- [ ] 전체 아키텍처 다이어그램
- [ ] 파이프라인 설계/설명
- [ ] DB ERD
- [ ] 점수 계산 공식 상세 문서
- [ ] 모델 구조 & 피처 목록 문서

### 8-2 개발 가이드
- [ ] VS Code + Codex 개발 가이드
- [ ] 서버 운영 가이드
- [ ] 배포/업데이트 매뉴얼
- [ ] 버전 관리 규칙(SemVer 2.0)

### 8-3 운영 가이드
- [ ] 데이터 업데이트 실패 대응 문서
- [ ] 모델 drift 대응 절차
- [ ] 백테스트 검증 프로세스
- [ ] 실험 기록 템플릿

---

# 🎯 v5 핵심 목표 요약
- DB 중심 파이프라인
- 모델/점수 체계 v5 업그레이드
- Walk-forward 기반 계량화 백테스트 프레임워크
- Node/React 대시보드에서 Top20/포트폴리오/리스크 시각화
- 운영 리포트 자동화
- (중장기) 자동매매 기반 구축
