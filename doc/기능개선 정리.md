1. 점수지표 분석 및 업그레이드
2. 예측률강화
3. 메인 페이지 개선, 점수 항목 그래프
4. 상세화면 개선, 차트 추가
5. 실시간 주가 변동
6. 파이프라인 자동화 스케줄링 실행
7. 회원가입
8. 권한설정
9. 각 소스별 문서 필요
10. 활용 디비 조사
11. 호스팅 신청


당연하지, 이 정도로 생각 정리해둔 사람은 흔치 않아 😄
지금 써준 EPIC 로드맵 + 추가 개선사항까지 전부 묶어서 **“v5 마스터 문서용 목차(장 구조)”**로 재정리해볼게.

---

## 📖 Lee_trader v5 마스터 목차(장 구조 제안)

### 1장. 프로젝트 개요 & 목표

1.1. 프로젝트 목적

* 개인 운용 + 추천 웹서비스 + 향후 자동매매까지 연결
* **핵심 가치**:

  * 점수 기반 종목 추천
  * 예측 신뢰도(확률/분산/백테스트)
  * “왜 이 종목인지”를 설명하는 리포트

1.2. v5 핵심 목표

* DB 중심 파이프라인
* 모델/점수 체계 v5
* Walk-forward 백테스트 프레임워크
* Node/React 대시보드
* 운영 리포트 자동화
* (중장기) 자동매매 기반

1.3. 버전 전략 & 로드맵

* v5.0: **파이프라인/DB/기본 UI 안정화**
* v5.1: **모델·점수 업그레이드 + UI 그래프 강화**
* v5.2: **스케줄링 자동화 + 호스팅/권한/회원 시스템**
* v6.x: 자동매매, 외부 브로커 연동

---

### 2장. 시스템 아키텍처 & 인프라 (EPIC 1, 4 일부, 8 일부)

2.1. 전체 아키텍처 다이어그램

* Python 파이프라인 ↔ SQLite DB ↔ Node API ↔ 프론트(React/HTML)

2.2. Docker / 실행 환경

* EPIC 1-1, 1-2

  * Python/Node Dockerfile 구조
  * docker-compose(파이프라인 / 웹 서버 / 스케줄러)
  * Windows + WSL + Docker 환경 가이드
  * .env / secrets 템플릿

2.3. 의존성 & 패키지 관리

* requirements.txt → pyproject.toml (uv/poetry)
* dev/test/prod 분리
* 버전 업데이트 체크/크론

2.4. 로깅·모니터링

* run_step 공통 래퍼
* 각 스텝 I/O 메트릭
* pipeline_run.json 로그 포맷
* 에러 리포트 자동 생성
* 시장/모델 이상 알림 구조(슬랙/메일 등)

2.5. 테스트 프레임워크

* pytest 세팅
* `feature_builder`, `label_builder`, `scoring`, backtest, Node API 테스트

---

### 3장. 데이터 & 파이프라인 (EPIC 2 + “파이프라인 자동화/디비 조사” 일부)

3.1. 데이터 소스 & 구조 개요

* 가격(KIS/pykrx)
* 재무(DART)
* 유니버스(시총+관심종목)
* 시장 지표(KOSPI, 변동성, 외국인 수급)

3.2. 파이프라인 단계별 정리

* Universe 생성
* prices_raw → clean → adjusted
* fundamentals → quality
* features
* labels
* predictions
* scores_final
* ranking_final

3.3. CSV ↔ DB 일원화 (EPIC 2-3)

* 각 스텝에서 바로 DB write, CSV는 옵션
* schema.sql 정리
* (선택) Alembic / 마이그레이션 구조

3.4. 데이터 품질·밸리데이션 (EPIC 2-1, 2-2, 2-4)

* 가격 이상치, 결측 자동 리포트
* KIS vs pykrx mismatch
* DART 재무 데이터 검증
* 액면분할/유상증자 로그
* pydantic 스키마 / great_expectations 파이프라인
* 시장 지표/재무/퀄리티 날짜 매핑 정합성

3.5. 활용 DB 조사 / 저장 전략 (추가 개선사항 10)

* 어떤 데이터는 **장기 보관(성능/로깅)**
* 어떤 건 **요약 테이블로 축약**
* 백업/백테스트용 raw 유지 전략

---

### 4장. 모델 & 점수 시스템 v5 (EPIC 3 + 추가 개선사항 1, 2)

4.1. 피처 설계 (EPIC 3-1)

* Level 1 피처: 모멘텀/가격괴리/변동성/거래량
* 섹터/업종 one-hot
* 시장 상태 one-hot
* 이벤트 피처(실적/공시/배당)
* 캘린더(주말/공휴일 등)

4.2. 모델 구조 (EPIC 3-2)

* 수익률 모델 / MDD 모델 분리
* Top20 분류 모델
* 앙상블(GBM + CatBoost + XGB stacking)
* TimeSeriesSplit 검증, drift 모니터링

4.3. 점수 시스템 v5 (EPIC 3-3 + “점수지표 분석/업그레이드”)

* `ret_score, prob_score, qual_score, tech_score, pred_score, risk_penalty` 정의
* **final_score 공식 상세화**
* 예측 신뢰도:

  * 예측 분산, 확률, 백테스트 기반 confidence interval
* 점수지표 분석 절차:

  * 각 점수 분위수별 수익률 / 승률
  * 점수별 MDD, 변동성

4.4. 예측률 강화 전략 (추가 개선사항 2)

* 피처 중요도 분석
* 데이터 기간 확장 & 스플릿 전략 조정
* 모델 튜닝(learning rate, depth, regularization)
* 리포트: “최근 3개월 예측 성능”

4.5. 전략 & 백테스트 프레임워크 (EPIC 3-4)

* Walk-forward 표준 셋업
* 리밸런싱 주기(일/주/월)
* 거래 비용·슬리피지 반영
* 포트폴리오 최적화(섹터 제한, 리스크 버짓)
* 전략 비교 리포트:

  * 기존 전략 vs v5 전략 vs 벤치마크

---

### 5장. 웹 서비스 & UI/리포트 (EPIC 4, 5 + 추가 개선사항 3, 4, 5, 7, 8)

5.1. Node API 설계 (EPIC 4-1)

* `/api/ranking?date=` 오늘/과거 랭킹
* `/api/stocks/:code/history` 차트용 데이터
* `/api/model/metrics` 모델 품질
* `/api/strategy/backtest` 파라미터 기반 간단 백테스트
* `/api/trades/export` CSV 다운로드

5.2. 인증/회원/권한 (추가 개선사항 7, 8)

* 회원가입/로그인(최소 JWT or 세션)
* 권한 레벨:

  * 비로그인: Top3 요약만
  * 로그인: 전체 랭킹/상세
  * Admin: 백테스트 결과, 모델 메트릭, 설정 변경

5.3. 메인 페이지(UI) 개편 (EPIC 5-1 + 추가 개선사항 3, 5)

* React/Vue 전환 or public HTML 유지 전략
* Top20 테이블 + 점수 항목 그래프

  * final_score, 예측수익률, 리스크, 퀄리티 등
* 실시간/준실시간 주가 반영 구조

  * 폴링 or SSE/WebSocket
  * “현재가 vs 추천 당시 가격” 뱃지

5.4. 종목 상세 화면 (EPIC 5-1/5-2 + 추가 개선사항 4)

* 종목 카드:

  * 점수 breakdown
  * 예측 수익률 / 예측 MDD / 확률
* 차트:

  * 가격 차트
  * 점수 추세, 예측 vs 실제
* 리포트:

  * “이 종목을 추천하는 이유” 텍스트 블럭

5.5. 대시보드 & 리포트 (EPIC 5-2, 5-3)

* TodayAction 카드(매수/추가/홀드/축소)
* 섹터별 heatmap
* 포트폴리오 위험지표(MDD, VaR)
* Daily / Weekly 리포트 (HTML/MD/PDF)
* Slack/Discord Webhook 알림

---

### 6장. 포트폴리오 & 리스크 관리 (EPIC 6)

6.1. 포트폴리오 룰

* 종목 비중 상한, 섹터 상한
* 변동성 기반 포지션 크기 조절
* 목표 변동성 전략

6.2. 리스크 모듈

* 종목별/포트폴리오 MDD 계산
* 상관계수 기반 리스크
* 시장 상태(상승/횡보/하락) 분류
* 종목 위험등급(High/Medium/Low)

6.3. 거래 기록·성과 측정

* Node UI에서 거래 입력
* 자동 수익률, 월별 수익률, CAGR
* 전략별 비교, 운용 리포트 자동 생성

---

### 7장. 운영·스케줄링·호스팅 (EPIC 1, 2 일부 + 추가 개선사항 6, 11)

7.1. 파이프라인 자동 실행 (추가 개선사항 6)

* 하루 단위 스케줄(장 마감 후)
* cron / systemd / GitHub Actions 등 선택
* 실패 시 재시도 & 알림

7.2. DB 운영 전략

* 인덱스 튜닝(가격/랭킹)
* holdings 계산 SQL 최적화
* vacuum / optimize 스케줄
* 백업 정책

7.3. 호스팅 전략 (추가 개선사항 11)

* 초기: 개인 서버 + 도메인 포워딩
* 이후: 클라우드(예: Lightsail, Render, Railway 등)
* SSL, reverse proxy, 도메인 연결

7.4. 운영 모니터링

* 에러 로그 대시보드
* 모델/데이터 이상 탐지 시 알림
* 배포/롤백 프로세스

---

### 8장. 문서 & 개발/운영 가이드 (EPIC 8 + 추가 개선사항 9)

8.1. 기술 문서

* 전체 아키텍처
* 파이프라인 설계
* DB ERD
* 점수 계산 공식
* 모델 구조 & 피처 목록

8.2. 소스별 문서 (추가 개선사항 9)

* `python/` 각 파일별 역할·입출력
* `node/` API 라우트별 설명
* `data/` 디렉토리 & 파일 설명
* 마크다운 기준 템플릿(“파일 헤더 설명” 통일)

8.3. 개발 가이드

* VSCode + Codex + GPT 사용법
* 로컬/도커 개발 워크플로우
* 브랜치 전략 / 버전 규칙

8.4. 운영 가이드

* 데이터 업데이트 실패 대응
* 모델 drift 대응
* 백테스트 검증 프로세스
* 실험 기록 템플릿

---

## 🔚 한 줄 요약

* 지금 네가 써둔 EPIC 로드맵 + “추가 개선사항 11개”를
  **8개의 “장(Chapter)”로 재배치해서, 바로 PRD/위키/깃허브 프로젝트에 넣을 수 있는 형태**로 정리한 거야.
* 이 구조대로라면,

  * **4장(모델/점수)** + **5장(UI)**를 먼저 집중 개발해서
    “보이는 추천 시스템 + 신뢰도 설명”을 만들고,
  * 그 다음에 7장(스케줄링/호스팅), 2/3장(인프라/데이터 정리)을 단계별로 강화하면 돼.

원하면 **“지금 당장 v5.0에서 할 일만 체크된 버전”**으로 줄여서 To-do 리스트도 다시 뽑아줄게.
